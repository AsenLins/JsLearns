
<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="css/style.css" rel="stylesheet">
    </head>
    <body>



        <div>
            <input type="input" id="input_text" value="è¿™æ˜¯ä¸€æ¡é»˜è®¤ä¿¡æ¯ã€‚" />
            <input id="btn_send" onclick="sendTextMessage()" type="button" value="å‘é€" />
        </div>
        <div id="show"></div>
        <script src="lib/RongIMLib-2.2.9.min.js"></script>
        <script src="lib/RongEmoji-dev.js"></script>
        <script src="lib/RongIMVoice-2.2.6.js"></script>
        <script src="script/init.js"></script>
      
        <script>

/*
æ¶ˆæ¯å…¨éƒ¨ç”¨å•èŠï¼Œuser8 -> user9
*/
var conversationType = RongIMLib.ConversationType.PRIVATE; // ç§èŠ
 /*
 PRIVATE 				1		å•èŠ
 DISCUSSION 			2		è®¨è®ºç»„
 GROUP 					3		ç¾¤ç»„
 CHATROOM 				4		èŠå¤©å®¤
 CUSTOMER_SERVICE 		5		å®¢æœ
 SYSTEM 				6		ç³»ç»Ÿæ¶ˆæ¯
 APP_PUBLIC_SERVICE 	7		åº”ç”¨å…¬ä¼—è´¦å·ï¼ˆåº”ç”¨å†…ç§æœ‰ï¼‰
 PUBLIC_SERVICE 		8		å…¬ä¼—è´¦å· (å…¬æœ‰)
 */



var targetId = "user9"; 
var targetId2 = "user10";
var targetIds = [];
//æ¶ˆæ¯æ¥æ”¶æ–¹ Idï¼Œæ ¹æ®ä¸åŒçš„ ConversationTypeï¼Œå¯èƒ½æ˜¯ç”¨æˆ· Idã€è®¨è®ºç»„ Idã€ç¾¤ç»„ Idã€èŠå¤©å®¤ Idç­‰ã€‚

var begin = 0;



function showTips(data){
	var dom = document.getElementById("show");
		dom.style.display = "block";
	if(data){
		dom.innerHTML += "<li>" + data + "</li>";
	}else{
		dom.innerHTML = "";
	}
}


function getTimer(begin){
	var now = new Date().getTime();
	return " time:" + (now - begin) + " ms";
}




function afterConnected(){
    console.log("é“¾æ¥æˆåŠŸ");
    //document.getElementById("panel").style.display = "none";
	//document.getElementById("btns").style.display = "block";
}

function disconnect(){
	/*
	æ–‡æ¡£ï¼šhttp://www.rongcloud.cn/docs/api/js/RongIMClient.html
	*/

	var start = new Date().getTime();
	instance.disconnect();
	showResult("æ–­å¼€é“¾æ¥ æˆåŠŸ", null , start);
}

function startInit(){
    appKey="cpj2xarlc74xn";
    token="2Y869KCAiQEv5kYGBLEYycNVcJirBFljL7M07UlG8TYGGfKZKrGXWMOJBC2f8EbtTMYxsX2VSg8=";
    //appKey = document.getElementById("appkey").value;
	//token = document.getElementById("token").value;

	if(appKey == "" || token == ""){
		alert("å¿…é¡»æä¾›appkeyå’Œtoken");
	}

	targetIds ="user9,user10"; //document.getElementById("targetId").value;
	if(targetIds == ""){
		alert("å¿…é¡»æä¾›ä¸¤ä¸ªçš„æœ‰æ•ˆtargetId");
	}

	targetIds = targetIds.split("ï¼Œ").join(",").split(",");
	targetId = targetIds[0];	
	targetId2 = targetIds[1];	

	showTips();

	begin = new Date().getTime()

	//å…¬æœ‰äº‘åˆå§‹åŒ–
	var config = {
        //protobuf: './local-sdk/protobuf-2.2.7.min.js' //æ”¯æŒhttp(s)ç½‘ç»œè·¯å¾„ã€æœ¬åœ°ç›¸å¯¹è·¯å¾„
    };

	var params = {
		appKey : appKey,
		token : token
	};

	var callbacks = {
		getInstance : function(_instance){
			instance = _instance;
		},
		receiveNewMessage : function(message){
			// åˆ¤æ–­æ¶ˆæ¯ç±»å‹
		    showTips("æ–°æ¶ˆæ¯ï¼Œç±»å‹ä¸ºï¼š" + message.messageType);
            // showResult("æ–°æ¶ˆæ¯",message,start);

            console.log("messageUId:" + message.messageUId + ",   messageId:" + message.messageId);
            console.log(message);
		},
		getCurrentUser : function(userInfo){
			showTips("é“¾æ¥æˆåŠŸ ç”¨æˆ·idï¼š" + userInfo.userId + ", è€—æ—¶" + getTimer(begin));
			userId = userInfo.userId;
		    afterConnected();
		}
    };
    console.log(params);
    console.log(callbacks);
    console.log(config);
	init(params,callbacks,config);
	showTips("åˆå§‹åŒ– åº”ç”¨ " + getTimer(begin));


	RongIMLib.RongIMEmoji.init();
	showTips("åˆå§‹åŒ– è¡¨æƒ…åº“ " + getTimer(begin));


	RongIMLib.RongIMVoice.init();
	showTips("åˆå§‹åŒ– å£°éŸ³åº“ " + getTimer(begin));
}         

startInit();

var recallMessage = null, clearMessage;
function markMessage(message){
	recallMessage = message;
	clearMessage = message;
}

function sendTextMessage(){
	/*
	æ–‡æ¡£ï¼š http://www.rongcloud.cn/docs/web.html#5_1ã€å‘é€æ¶ˆæ¯
		   http://rongcloud.cn/docs/api/js/TextMessage.html
	1: å•æ¡æ¶ˆæ¯æ•´ä½“ä¸å¾—å¤§äº128K
	2: conversatinType ç±»å‹æ˜¯ numberï¼ŒtargetId ç±»å‹æ˜¯ string
	*/

	/*
		1ã€ä¸è¦å¤šç«¯ç™»é™†ï¼Œä¿è¯æ‰€æœ‰ç«¯éƒ½ç¦»çº¿
		2ã€æ¥æ”¶ push è®¾å¤‡è®¾ç½®:
			ï¼ˆ1ï¼‰æ‰“å¼€ç³»ç»Ÿé€šçŸ¥æé†’
			ï¼ˆ2ï¼‰å°ç±³è®¾ç½® â€œæˆæƒç®¡ç†â€ ï¼> â€œè‡ªå·±çš„åº”ç”¨â€ ä¸ºè‡ªå¯åŠ¨
			ï¼ˆ3ï¼‰åº”ç”¨å†…ä¸è¦å±è”½æ–°æ¶ˆæ¯é€šçŸ¥
		3ã€å†…ç½®æ¶ˆæ¯ç±»å‹ï¼Œé»˜è®¤ pushï¼Œè‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹éœ€è¦
		   pushData æ˜¾ç¤ºé€»è¾‘é¡ºåºï¼šè‡ªå®šä¹‰ > é»˜è®¤
		4ã€å‘é€å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸å‘é€ TextMessage é€»è¾‘ã€æ–¹å¼ä¸€è‡´
	*/
	var pushData = "pushData" + Date.now();

	var isMentioned = false;
    var strText=document.getElementById("input_text").value;
    showTips("å‘é€çš„textæ˜¯ï¼š"+strText);
	var content = {
        /*
		content: [
			"é˜¿æ‹‰ä¼¯è¯­ï¼šØ§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø· ",
			"å¸Œä¼¯æ¥è¯­ï¼š×”××–×¨×— ×”×ª×™×›×•×Ÿ",
			"emoji: ğŸ˜Š ",
			"å¸Œè…Šå­—æ¯ï¼š Ï€ï¼ŒÎ±ï¼ŒÎ², ",
			"æ•°å­—å•ä½éƒ¨åˆ†å­—ç¬¦ å¦‚ï¼šÃ— ",
			"æ‹‰ä¸æ–‡æ‰€æœ‰å­—ç¬¦ å¦‚ï¼šÎŸ Î¡ Ïƒ Ã Ã† ",
			"æ‹¼éŸ³æ‰€æœ‰å­—ç¬¦ å¦‚ï¼š Ä› Ã¬ Åˆ ",
			"è‹±æ–‡éŸ³æ ‡éƒ¨åˆ†å­—ç¬¦ å¦‚ ï¼š É™ Êƒ ",
			"ä¿„æ–‡éƒ¨åˆ†å­—ç¬¦ å¦‚ ï¼šÑˆ ; âŠ‡ Ã¢ Å’ Å  â„¢ "
        ].join(","),
        */
        content:[strText],
		user : {
			"id" : "this-is-a-test-id",	//ä¸æ”¯æŒä¸­æ–‡åŠç‰¹æ®Šå­—ç¬¦
			"name" : "å¼ ä¸‰",
			"portrait" : "http://rongcloud.cn/images/newVersion/log_wx.png"
		},
		extra: "{\"key\":\"value\", \"key2\" : 12, \"key3\":true}"
	};

	var msg = new RongIMLib.TextMessage(content);

	var start = new Date().getTime();
	instance.sendMessage(conversationType, targetId, msg, {
        onSuccess: function (message) {
        	markMessage(message);
            showResult("å‘é€æ–‡å­—æ¶ˆæ¯ æˆåŠŸ",message,start);
        },
        onError: function (errorCode,message) {
            showResult("å‘é€æ–‡å­—æ¶ˆæ¯ å¤±è´¥",message,start);
        }
    }, isMentioned, pushData);
}

function showResult(title,code,start){
    var now = new Date().getTime();
	console.log( title,"æ‰§è¡Œæ—¶é—´ï¼š", (now - start));
    console.log(code);
    //jsonOprators(code);
}

        </script>
    </body>
</html>